# Отчёт по заданию операционные системы UNIX/Linux (Базовый)
## Содержание
* [Part 1. Установка ОС](#part-1-установка-ос)
* [Part 2. Создание пользователя](#part-2-создание-пользователя)
* [Part 3. Настройка сети ОС](#part-3-настройка-сети-ос)
* [Part 4. Обновление ОС](#part-4-обновление-ос)
* [Part 5. Использование команды sudo](#part-5-использование-команды-sudo)
* [Part 6. Установка и настройка службы времени](#part-6-установка-и-настройка-службы-времени)
* [Part 7. Установка и использование текстовых редакторов](#part-7-установка-и-использование-текстовых-редакторов)
* [Part 8. Установка и базовая настройка сервиса SSHD](#part-8-установка-и-базовая-настройка-сервиса-sshd)
* [Part 9. Установка и использование утилит top, htop](#part-9-установка-и-использование-утилит-top-htop)
* [Part 10. Использование утилиты fdisk](#part-10-использование-утилиты-fdisk)
* [Part 11. Использование утилиты df](#part-11-использование-утилиты-df)
* [Part 12. Использование утилиты du](#part-12-использование-утилиты-du)
* [Part 13. Установка и использование утилиты ncdu](#part-13-установка-и-использование-утилиты-ncdu)
* [Part 14. Работа с системными журналами](#part-14-работа-с-системными-журналами)
* [Part 15. Использование планировщика заданий CRON](#part-15-использование-планировщика-заданий-cron)
## Part 1. Установка ОС
1. Установка виртуальной машины
2. Загрузка образа Ubuntu 20.04 Server LTS
3. Установка ОС на виртуальную машину
4. Проверка версии Ubuntu с помощью команды cat /etc/issue

![Проверка версии Ubuntu](../misc/report_images/part1.png)
* Папка "etc" является стандартной директорией в многих операционных системах, включая UNIX-подобные системы. В этой папке обычно содержатся конфигурационные файлы для различных программ и системных служб.  Файл etc/issue обычно содержит приветственное сообщение или информацию о системе.
## Part 2. Создание пользователя
1. С помощью команды adduser создаём нового пользователя new_user

![Добавление нового пользователя](../misc/report_images/part2-1.png)

2. С помощью команды usermod -aG добавляем new_user в группу adm
* Команда usermod в Linux используется для изменения параметров учетной записи пользователя. Параметр -aG обозначает следующее: a - добавить, G - указывает группу
3. С помощью команды groups можно посмотреть, в какие группы входит новый пользователь
4. Информацию обо всех пользователях можно найти в файле /etc/passwd
![Проверка файла /etc/passwd](../misc/report_images/part2-4.png)
* Как можно увидеть на скриншоте, new_user был добавлен в конец файла
## Part 3. Настройка сети ОС
* Сетевые интерфейсы предназначены для передачи данных между программами через компьютерную сеть.
В Linux любые данные, которые компьютер отправляет в сеть или получает из сети, проходят через сетевой интерфейс. Сетевые интерфейсы могут быть как физическими, так и виртуальными.

1. Задание названия машины user-1 с помощью команды hostname

![hostname](../misc/report_images/part3-1.png)

* Изменение файлов /etc/hostname и /etc/hosts

2. Установка временной зоны с помощью команды timedatectl set-timezone

![timedatectl](../misc/report_images/part3-2.png)

3. Вывод сетевых интерфейсов с помощью команды ip a

![timedatectl](../misc/report_images/part3-3.png)
* lo (loopback device) – виртуальный интерфейс, присутствующий по умолчанию в любом Linux. Он используется для отладки сетевых программ и запуска серверных приложений на локальной машине. С этим интерфейсом всегда связан адрес 127.0.0.1. У него есть dns-имя – localhost. Посмотреть привязку можно в файле /etc/hosts.

4. Получение ip-адреса устройства от DHCP сервера
* Для работы по сети любому устройству требуется IP-адрес. В протоколе IPv4 это числовой идентификатор, состоящий из 4 разрядов, каждый из которых отделяется точкой, без него устройство не может быть определено в сетевой инфраструктуре. \
Прикладной протокол DHCP выполняет всю работу по подбору сетевых настроек автоматически, без необходимости присваивать вручную каждому устройству свой IP-адрес. Это очень упрощает работу системного администратора в случае расширения сети.
* Обычно логи Linux находятся в файле /var/log. Когда DHCP-сервер предлагает клиенту IP-адрес, он отправляет сообщение DHCPOFFER, которое содержит его собственный IP-адрес и IP-адрес, предлагаемый клиенту. Это сообщение также записывается в лог-файл. Лог-файлы содержат очень много информации. Поэтому, чтобы найти только конкретную информацию (DHCPOFFER), мы отфильтруем ее с помощью команды grep.

![ip of device](../misc/report_images/part3-4.png)

5. Определяем внешний ip-адрес шлюза

![Внешний ip-адрес](../misc/report_images/part3-5.png)

* curl - утилита командной строки, предназначенная для передачи данных по URL
* ifconfig.me - веб-сервис, который предоставляет внешний ip-адрес в формате текста, который можно получить через HTTP запрос

6. Определяем внутренний ip-адрес шлюза

![Внешний ip-адрес](../misc/report_images/part3-6.png)

* Команда ip route используется для отображения таблицы маршрутизации

7. Изменяем yaml файл в /etc/netplan/, принимаем изменения командой netplan apply

![Статический ip](../misc/report_images/part3-7.png)

8. После перезагрузки ОС проверяем, изменился ли ip-адрес сетевого интерфейса командой ip a

![Проверка статического ip](../misc/report_images/part3-8.png)

9. Теперь пропингуем удаленные хосты 8.8.8.8 и ya.ru

![8.8.8.8](../misc/report_images/part3-9.png)

![ya.ru](../misc/report_images/part3-10.png)
## Part 4. Обновление ОС
1. Командой apt update загружаем информацию о доступных версиях пакетов, их зависимостях, а также списке новых пакетов
2. Воспользуемся командой apt upgrade для фактического обновления установленных пакетов до их последних версий

![update](../misc/report_images/part4.png)
## Part 5. Использование команды sudo
*  Команда sudo (substitute user and do) позволяет строго определенным пользователям выполнять указанные программы с административными привилегиями без ввода пароля суперпользователя root. Если быть точнее, то команда sudo позволяет выполнять программы от имени любого пользователя, но, если идентификатор или имя этого пользователя не указаны, то предполагается выполнение от имени суперпользователя root. Таким образом, использование sudo позволяет выполнять привилегированные команды обычным пользователям без необходимости ввода пароля суперпользователя root
1. Разрешаем newusr выполнять команду sudo

![sudo](../misc/report_images/part5-1.png)

2. От имени newusr меняем hostname

![hostname from newusr](../misc/report_images/part5-2.png)
## Part 6. Установка и настройка службы времени
1. Меняем файл /etc/systemd/timesyncd.conf как показано ниже

![timesyncd.conf](../misc/report_images/part6-1.png)

2. Запускаем службу timesyncd командами systemctl start timesyncd и systemctl enable timesyncd
3. Теперь выведем информацию о текущих настройках даты и времени  с помощью команды timedatectl show
![show timedate](../misc/report_images/part6-2.png)
## Part 7. Установка и использование текстовых редакторов
1. С помощью команды apt-get install устанавливаем vim, nano и joe
2. Создадим файл test_vim.txt командой vim test_vim.txt. Чтобы начать писать нужно нажать на i, чтобы перестать писать - esc, чтобы выйти из файла с сохранением содердимого - :wq

![vim-1](../misc/report_images/part7-1.png)

3. Проделаем тоже самое только для файла test_nano.txt. Просто начинаем писать в файле. После окончания ввода нажимаем ^x и сохраняем файл

![nano-1](../misc/report_images/part7-2.png)

4. Теперь тоже самое с joe. Просто начинаем писать в файле. После окончания ввода нажимаем ctrl-k q и сохраняем файл

![joe-1](../misc/report_images/part7-3.png)

5. Отредактируем файл test_vim.txt без сохранения изменений. Чтобы выйти из файла без сохранения содердимого нужно ввести после окончания ввода :q!

![vim-2](../misc/report_images/part7-4.png)

6. Отредактируем файл test_nano.txt без сохранения изменений. Чтобы выйти из файла без сохранения содердимого нужно ввести ^X и нажать n.

![nano-2](../misc/report_images/part7-5.png)

7. Отредактируем файл test_joe.txt без сохранения изменений. Чтобы выйти из файла без сохранения содердимого нужно ввести ctrl-k q и нажать n.

![joe-2](../misc/report_images/part7-6.png)

8. Чтобы найти и заменить слово в vim, нужно нажать : и ввести %s/искомое_слово/заменяющее_слово.

![vim-3](../misc/report_images/part7-7.png)

9. Чтобы найти слово в nano, нужно нажать ctrl + w или ctrl + q и ввести искомое слово

![nano-3](../misc/report_images/part7-8.png)

10. Чтобы найти и заменить слово в nano, нужно нажать ctrl + \ и ввести искомое слово и заменяющее слово

![nano-4](../misc/report_images/part7-9.png)

11. Чтобы найти и заменить слово в joe, нужно нажать ctrl+k-f и ввести искомое слово и заменяющее слово

![joe-3](../misc/report_images/part7-10.png)
## Part 8. Установка и базовая настройка сервиса SSHD
* SSH или Secure Shell - это сетевой протокол безопасного доступа из одного компьютера к другому по сети.\
SSHd — это служба, принимающая запросы на соединения от клиентов, т.е. других компьютеров. 
Настройка сервера SSH производится путём настройки программы-демона SSHd. 
Программа-демон - это программа, запускаемая самой системой и работающая в фоновом режиме.\
Режим работы SSH-сервера с настройками по-умолчанию хоть и является вполне работоспособным для небольших частных сетей, всё же нуждается в задании некоторых важных параметров для использования на высоконадёжных публичных серверах.
1. Устанавливаем сервис sshd командой apt install openssh-server
2. Добавляем автостарт службы при загрузке системы командой systemctl enable ssh
3. Перенастраиваем службу SSHd на порт 2022. Нужно открыть файл /etc/ssh/sshd_config и изменить его, как показано ниже

![sshd_config](../misc/report_images/part8-1.png)

4. Используя команду ps, показываем наличие процесса sshd

![ps](../misc/report_images/part8-2.png)

* Команда ps используется для отображения текущих процессов.\
Ключи a, u и x задают формат вывода: a выводит процессы для всех пользователей, а не только текущего, u выводит дополнительную информацию о пользователях, создавших процессы, x выводит процессы, не связанные с терминалом.\
| направляет вывод из первой команды во вторую.\
grep sshd используется для фильтрации строк, содержащих ключевое слово "sshd" из вывода ps aux. grep ищет строки, содержащие указанный текст.\

5. Вывод команды netstat -tan

![netstat](../misc/report_images/part8-3.png)

* netstat: Команда для вывода различных сетевых статистических данных, таких как активные соединения, порты, маршруты и другие.\
-tan:\
-t: Отображает только TCP-соединения.\
-a: Выводит все активные соединения и слушающие порты.\
-n: Выводит числовые значения портов вместо их имен.
* Значения столбцов:\
Proto указывает на протокол, используемый для соединения.\
Recv-Q (Receive Queue) и Send-Q (Send Queue) отображают количество байт в очереди на прием и отправку соответственно.\
Local Address показывает локальный IP-адрес и порт. Для серверов, это адрес и порт, на котором сервер прослушивает соединения.\
Foreign Address показывает IP-адрес и порт удаленного узла, с которым установлено соединение.\
State - состояние соединения (LISTEN, ESTABLISHED, TIME_WAIT).
* 0.0.0.0 в столбце Local Address означает "все доступные интерфейсы" или "любой адрес". Это значение используется для обозначения того, что сервер прослушивает все доступные сетевые интерфейсы на данной машине как локальные (127.0.0.1), так и внешние.
## Part 9. Установка и использование утилит top, htop
* Команда top показывает запущенные в Linux процессы программ и служб, данные о потреблении системных ресурсов и позволяет искать, останавливать процессы и управлять ими.
* Команда htop выполняет примерно ту же задачу, что и top, но имеет определённые преимущества и недостатки: более удобные поиск и фильтрация, но менее гибкая настройка отображения процессов.
1. Команда top

![top](../misc/report_images/part9-1.png)

uptime - 21 мин\
количество авторизованных пользователей - 1\
общая загрузка системы - 0.03, 0.14, 0.20 за 1, 5, 15 минут соответсвенно\
общее количество процессов - 189\
загрузка cpu - процессор простаивает на 95.3%\
загрузка памяти - из 1963.9 МБ свободны 174.5 МБ\
pid процесса, занимающего больше всего памяти - 1416\
pid процесса, занимающего больше всего процессорного времени - 1225

2. Команда htop
* Сортировка по PID

![pid](../misc/report_images/part9-2.png)

* Сортировка по PERCENT_CPU

![PERCENT_CPU](../misc/report_images/part9-3.png)

* Сортировка по PERCENT_MEM

![PERCENT_MEM](../misc/report_images/part9-4.png)

* Сортировка по TIME

![TIME](../misc/report_images/part9-5.png)

* Фильтр для процесса sshd

![sshd](../misc/report_images/part9-6.png)

* Процесс syslog, найденный с использованием поиска

![syslog](../misc/report_images/part9-7.png)

![additional](../misc/report_images/part9-8.png)

## Part 10. Использование утилиты fdisk
* fdisk - это команда для управления разделами жёсткого диска, а также получения информации о них
1. Вывод команды fdisk -l

![fdisk](../misc/report_images/part10-1.png)
![fdisk](../misc/report_images/part10-2.png)

Название диска - VBOX HARDDISK\
Размер - 30 ГБ\
Количество секторов - 62914560\
Размер swap - 29.5 ГБ
## Part 11. Использование утилиты df
* df - это команда для получения подробного отчета об использовании дискового пространства системы
1. Вывод команды df

![df](../misc/report_images/part11-1.png)

Для корневого раздела /dev/sda5 (/):\
размер раздела - 30268356 КБ\
размер занятого пространства - 10339088 КБ\
размер свободного пространства - 18366388 КБ\
процент использования - 37%

2. Вывод команды df -Th
* -T добавляет к выводу информацию о типе файловой системы
* -h отображает размеры в удобочитаемом формате

![df -Th](../misc/report_images/part11-2.png)

Для корневого раздела /dev/sda5 (/):\
размер раздела - 29 ГБ\
размер занятого пространства - 9.9 ГБ\
размер свободного пространства - 18 ГБ\
процент использования - 37%
## Part 12. Использование утилиты du
* du - это команда для получения приблизительного объема дискового пространства, используемого указанными при вызове команды файлами или каталогами
1. Вывод команды du для /home, /var, /var/log

![du /home /var](../misc/report_images/part12-1.png)

![du /var/log](../misc/report_images/part12-2.png)

* Размер папок указан в байтах
2. Вывод команды du -h для /home, /var, /var/log

![du -h /home /var](../misc/report_images/part12-3.png)

![du -h /var/log](../misc/report_images/part12-4.png)

3. Вывод команды du -h для /var/log*

![du -h /var/log*](../misc/report_images/part12-5.png)
## Part 13. Установка и использование утилиты ncdu
* ncdu - это команда, имеющая то же назначение, что и du, но обладающая приятным и удобным интерфейсом
1. Командой apt-get install ncdu устанавливаем ncdu
2. Вывод команды ncdu /home

![ncdu /home](../misc/report_images/part13-1.png)

3. Вывод команды ncdu /var

![ncdu /var](../misc/report_images/part13-2.png)
## Part 14. Работа с системными журналами
* Файл /var/log/dmesg содержит вывод ядра системы
* Файл /var/log/syslog содержит системные логи
* Файл /var/log/auth.log содержит логи аутентификации
1. В файле /var/log/auth.log с помощью команды cat находим время последней успешной авторизации, имя пользователя и метод входа в систему.

![cat /var/log/auth.log](../misc/report_images/part14-1.png)

* Как видно на скриншоте, время последней успешной авторизации - Dec 9 22:38:36, имя пользователя - user, метод входа в систему - с помощью пароля
2. Перезапускаем службу SSHd командой systemctl restart ssh
3. В файле /var/log/auth.log с помощью команды cat находим сообщение о рестарте службы

![cat /var/log/auth.log](../misc/report_images/part14-2.png)
## Part 15. Использование планировщика заданий CRON
* CRON - это программа-демон. Её основная задача выполнять указанные пользователем процессы в указанное пользователем время, например с определённой периодичностью.
1. Командой echo "*/2 * * * * uptime" | crontab - добавляем задачу на вывод uptime каждые 2 минуты

![CRON uptime each 2 min](../misc/report_images/part15-1.png)

2. Командой crontab -l выводим список текущих заданий для CRON

![crontab -l](../misc/report_images/part15-2.png)

3. Командой crontab -r удаляем все задания для CRON и снова выводим список заданий командой crontab -l

![crontab -r + -l](../misc/report_images/part15-3.png)
